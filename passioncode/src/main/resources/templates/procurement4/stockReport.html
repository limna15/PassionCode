<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{layout/basic::setContent(~{::content})}">

	<th:block th:fragment="content">


<style>
  table {
    width: 100%;
    border: 1px solid #444444;
    font-size: 13px;

  }
  th, td {
    border: 1px solid #444444;
    padding: 10px;
    text-align: center;
  }
.search-box {
	position: relative;
	float: right;
}

.search-box input {
	height: 34px;
	border-radius: 20px;
	padding-left: 35px;
	border-color: #ddd;
	box-shadow: none;
}

.search-box input:focus {
	border-color: #3FBAE4;
}

.search-box i {
	color: #a0a5b1;
	position: absolute;
	font-size: 19px;
	top: 8px;
	left: 10px;
}

.pagination {
	float: right;
	margin: 0 0 5px;
}

.pagination li a {
	border: none;
	font-size: 95%;
	width: 30px;
	height: 30px;
	color: #999;
	margin: 0 2px;
	line-height: 30px;
	border-radius: 30px !important;
	text-align: center;
	padding: 0;
}

.pagination li a:hover {
	color: #666;
}

.pagination li.active a {
	background: #03A9F4;
}

.pagination li.active a:hover {
	background: #0397d6;
}

.pagination li.disabled i {
	color: #ccc;
}

.pagination li i {
	font-size: 16px;
	padding-top: 6pxrow
}

.hint-text {
	float: left;
	margin-top: 6px;
	font-size: 95%;
}

</style>
		<div class="col-md-12 stretch-card" >
			<!-- 수정 부분 시작 -->
			<div class="card">
				<div class="card-body">
					<p class="card-title" style="font-size:23px;">재고금액 현황관리</p> 
					<br>
					<form>
						<div class="row" style="margin-bottom: 5px;">
							<!-- 기간 검색 시작 -->
							<div>
								<span style="font-size:20px;">기간</span>&nbsp;&nbsp;
								<input type="date" id="startDate" style="width:140px; height:40px; border-radius:5px; border:1px solid #dcdcdc; padding-left:12px;padding-right:12px;">&nbsp;&nbsp;~&nbsp;&nbsp;
								<input type="date" id="endDate" style="width:140px; height:40px; border-radius:5px; border:1px solid #dcdcdc; padding-left:12px;padding-right:12px;">&nbsp;&nbsp;
		                    </div>
							<!-- 기간 검색 끝 -->
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
							<!-- 대분류 중분류 검색 시작 -->	
							<div>
								<div style="display:inline-block;">
									<select class="custom-select mr-sm-2 largeCategoryCode" style="text-align: center;" name="largeCategoryCode" >
										<option selected value="0">대분류</option>
										<th:block th:each="LCDTO : ${LargeCategoryDTOList}">
											<option th:value="${LCDTO.code}">[[${LCDTO.category}]]</option>
										</th:block>
									</select>
								</div> 
								&nbsp;	
								<div style="display:inline-block;">
									<select class="custom-select mr-sm-2 middleCategoryCode" style="text-align: center;" name="middleCategoryCode" >
										<option selected value="0">중분류</option>
				                        <option value="1">-</option>
									</select>
								</div> 
								&nbsp;
								<div style="display:inline-block;"> 
									<button type="submit" class="btn btn-primary" >검색</button>
								</div>
		                    </div>
							<!-- 대분류 중분류 검색 끝 -->				
						</div>	
					</form>
					<br>
					<!-- 차트 들어가는 자리 -->						
					<div id="chartContainer" style="height: 370px; width: 100%;">
					
					</div>
					<script src="https://cdn.canvasjs.com/canvasjs.min.js"></script>

	
					<!-- 차트 들어가는 자리 끝 -->
				</div>
			</div>
		</div>	
		
		
		
		<script src="https://code.jquery.com/jquery-3.7.0.js" integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM=" crossorigin="anonymous"></script>
		<script th:inline="javascript" type="text/javascript">
		
	 	$(document).ready(function(e) {
	  		//-------------------------------------- 대분류 코드 변경마다 중분류 바꾸기! --------------------------------------------------------------//
	 		
			//대분류코드 변경될때마다 처리되는 함수
			//대분류코드 변경됨에 따라 중분류코드 바꿔주기 위한 함수
			$(document).on("change",".largeCategoryCode",function(){
				let selectedLCCode = $(this).val();
				console.log("선택된 대분류 코드 : ",selectedLCCode); 
				
				//대분류(값 : 0)클릭 할때는, 중분류,- 2개 보여주고, 나머지는 대분류코드에 따라 중분류 보여주게 하기 
				if(selectedLCCode==0){
					let completeHtml =``;
					completeHtml = makeOption(0,'중분류');
					completeHtml = completeHtml + makeOption(1,'-');
					document.querySelector(".middleCategoryCode").innerHTML = completeHtml;	
				}else{
					//대분류코드로 중분류리스트 찾는 ajax처리
					$.ajax({
						type : "post" ,
						url : "/procurement1/getMiddleCategoryByLargeCategory" ,     	//꼭 절대경로로! /붙이기 // .json 넣으면 응답을 json으로 함!
						data : selectedLCCode ,                							//보내는 데이터!(요청 데이터)
						contentType :"text/plain; charset=UTF-8" ,  					//보내는 데이터 형식 (전송 데이터,요청데이터)
						dataType : "json" ,							 					//받아오는 데이터 형식 (응답데이터) text, json, xml -생략시는 content type을 보고 자동처리
						success : function(data){        								//가져오는 데이터! (응답데이터)
							console.log("받아온 데이터 : ",data);
							//console.log("json 리스트 사이즈 보자 : ",data.length);
							
							//data를 이용해서, 중분류 셀렉트 옵션에 넣을 옵션들 -> html 만들기
							let completeHtml =``;    	
									
							data.forEach(function(item){
								completeHtml = completeHtml + makeOption(item.middleCode,item.middleCategory);							
							});						
							//console.log("완성된 html 보자",completeHtml);								
							
							/*
							//완성된 옵션들은 기존의 중분류코드 셀렉트에 바꿔주기
							$("#middleCategoryCode option").remove();
							$("#middleCategoryCode").append(completeHtml);		
							*/
							//middleCategoryCodeOptions.innerHTML = completeHtml;
							document.querySelector(".middleCategoryCode").innerHTML = completeHtml;	
						},
						error : function(jqXHR,textStatus,errorThrown){    
							//console.log(jqXHR); 			//응답 메시지
							//console.log(textStatus); 		//"error"로 고정인듯함
							//console.log(errorThrown);	
							console.log("대분류코드를 이용해서 중분류리스트 가져오는데 ajax 오류 발생!!!!!!");
						}
					});	//$.ajax
				} //if
			}); //대분류코드 변경됨에 따라 중분류코드 바꿔주기 위한 함수 끝
			
		
	 	});
	    	
      	//code와 category 값을 넣어서 option 만들기
	   	function makeOption(code,category){
	   		return `<option value=${code}>${category}</option>`;
	   	};    
		
	   	var mylabels1=[[${mylabels}]];
	   	console.log("mylabels1 이거 잙읽나??",mylabels1);
	   	
	   	var DateList=[[${DateList}]];
	   	var DateStrLisg=[[${DateStrLisg}]];
	   	var stockResultDTOs=[[${stockResultDTOs}]];
	   	
	   	let sentence = ``;
	   	for(var i=0; i<DateList.length-1;i++){
	   		//sentence=sentence+makeSentence(DateList[i],stockResultDTOs[i].);
	   	}
	   
	   	
		
		function makeSentence(date,price){
			let sentence =`{ x: ${date}, y: ${price} },`;
			return sentence;    				
		}
	   	codenameList.forEach(function(item){
				sentence=sentence+makeSentence(item.code,item.name);
			});
	   
	   	function mychart(){
	   		var chart = new CanvasJS.Chart("chartContainer", {
	   			animationEnabled: true,
	   			title:{
	   				text: "대분류별 재고금액"
	   			},
	   			axisX: {
	   				valueFormatString: "YYYY-MM-DD"
	   			},
	   			axisY: {
	   				title: "재고금액",
	   				suffix: " 원",
	   				minimum: -10,
	   			},
	   			legend:{
	   				cursor: "pointer",
	   				fontSize: 16,
	   				itemclick: toggleDataSeries
	   			},
	   			toolTip:{
	   				shared: true
	   			},
	   			data: [{
	   				name: "Myrtle Beach",
	   				type: "spline",
	   				yValueFormatString: "###,###,### 원",
	   				showInLegend: true,
	   				dataPoints: [
	   					{ x: new Date(2017,6,24), y: 5000 },
	   					{ x: new Date(2017,6,25), y: 0 },
	   					{ x: new Date(2017,6,26), y: 29 },
	   					{ x: new Date(2017,6,27), y: 0 },
	   					{ x: new Date(2017,6,28), y: 0 },
	   					{ x: new Date(2017,6,29), y: 0 },
	   					{ x: new Date(2017,6,30), y: -0 }
	   				]
	   			},
	   			{
	   				name: "Martha Vineyard",
	   				type: "spline",
	   				yValueFormatString: "#0.## °C",
	   				showInLegend: true,
	   				dataPoints: [
	   					{ x: new Date(2017,6,24), y: 20 },
	   					{ x: new Date(2017,6,25), y: 0 },
	   					{ x: new Date(2017,6,26), y: 0 },
	   					{ x: new Date(2017,6,27), y: 25 },
	   					{ x: new Date(2017,6,28), y: 0 },
	   					{ x: new Date(2017,6,29), y: 25 },
	   					{ x: new Date(2017,6,30), y: 0 }
	   				]
	   			},
	   			{
	   				name: "Nantucket",
	   				type: "spline",
	   				yValueFormatString: "#0.## °C",
	   				showInLegend: true,
	   				dataPoints: [
	   					{ x: new Date(2017,6,24), y: 22 },
	   					{ x: new Date(2017,6,25), y: 19 },
	   					{ x: new Date(2017,6,26), y: 23 },
	   					{ x: new Date(2017,6,27), y: 24 },
	   					{ x: new Date(2017,6,28), y: 24 },
	   					{ x: new Date(2017,6,29), y: 23 },
	   					{ x: new Date(2017,6,30), y: 23 }
	   				]
	   			},
	   			{
	   				name: "테스트",
	   				type: "spline",
	   				yValueFormatString: "#0.## °C",
	   				showInLegend: true,
	   				dataPoints: [
	   					{ x: new Date(2017,6,24), y: 20 },
	   					{ x: new Date(2017,6,25), y: 55 },
	   					{ x: new Date(2017,6,26), y: 51 },
	   					{ x: new Date(2017,6,27), y: 28 },
	   					{ x: new Date(2017,6,28), y: 22 },
	   					{ x: new Date(2017,6,29), y: 13 },
	   					{ x: new Date(2017,6,30), y: 19 }
	   				]
	   			}
	   			]
	   		});
	   		chart.render();
	   		
	   		function toggleDataSeries(e){
	   			if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
	   				e.dataSeries.visible = false;
	   			}
	   			else{
	   				e.dataSeries.visible = true;
	   			}
	   			chart.render();
	   		}
	   	}
	
		</script>	
		<script src="../../vendors/base/vendor.bundle.base.js"></script>
		<script src="../../vendors/chart.js/Chart.min.js"></script>
		<script src="../../js/off-canvas.js"></script>
		<script src="../../js/hoverable-collapse.js"></script>
		<script src="../../js/template.js"></script>
		<script src="../../js/chart.js"></script>
		<script src="../../js/dashboard.js"></script>
		<script src="../../js/dashboard2.js"></script>
		
		<script>
		mychart2();
		</script>
		
	</th:block>
</th:block>
</html>