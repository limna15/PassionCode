<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{/layout/basic::setContent(~{::content})}">
	<th:block th:fragment="content">

<style>
.search-box {
    position: relative;        
    float: right;
}
.search-box input {
    height: 34px;
    border-radius: 20px;
    padding-left: 35px;
    border-color: #ddd;
    box-shadow: none;
}
.search-box input:focus {
    border-color: #3FBAE4;
}
.search-box i {
    color: #a0a5b1;
    position: absolute;
    font-size: 19px;
    top: 8px;
    left: 10px;
}

   
.pagination {
    float: right;
    margin: 0 0 5px;
}
.pagination li a {
    border: none;
    font-size: 95%;
    width: 30px;
    height: 30px;
    color: #999;
    margin: 0 2px;
    line-height: 30px;
    border-radius: 30px !important;
    text-align: center;
    padding: 0;
}
.pagination li a:hover {
    color: #666;
}	
.pagination li.active a {
    background: #03A9F4;
}
.pagination li.active a:hover {        
    background: #0397d6;
}
.pagination li.disabled i {
    color: #ccc;
}
.pagination li i {
    font-size: 16px;
    padding-top: 6pxrow
}
.hint-text {
    float: left;
    margin-top: 6px;
    font-size: 95%;
}    
</style>

		<div class="col-md-12 stretch-card">
			<div class="card">
				<div class="card-body">
					<p class="card-title">진척검수 일정등록 및 평가</p>
                  <form>
                    <div class="form-row align-items-center">
                    <div class="col-auto my-1">
                        <select class="custom-select mr-sm-2" id="inlineFormCustomSelect">
                        <option selected>검색 조건 선택</option>
                        <option value="1">발주서 번호</option>
                        <option value="2">발주코드</option>
                        <option value="3">품목코드</option>
                        </select>
                    </div>
                    
                    <input type="text" style="width:150px;" class="form-control" placeholder="Search now" aria-label="search" aria-describedby="search">
                    <div class="col-auto my-1">
                      <button type="submit" class="btn btn-primary">검색</button>
                    </div>
                    </div>
                    </form>
					<div class="table-responsive">
						<table id="recent-purchases-listing" class="table"
							style="text-align: center;">
							<thead>
                        <tr>
                            <th>발주<br>코드</th>
                            <th>협력<br> 회사</th>
                            <th>조달납기<br>  예정일</th>
                            <th>품목</th>
                            <th>발주 수량</th>
                            <th>단가</th>
                            <th>다음 진척<br>검수 일정</th>
                            <th>진척 검수일정<br> 등록</th>
                            <th>진척 평가</th>
                            <th>납기 <br>진도율</th>
                            <th>검수 완료</th>
                            <th>발주서<br>마감<br> 상태</th>
                        </tr>
                      </thead>
                      <tbody>
                      <tr th:each="dto: ${pCheckList}" id="trList">
                            <td><input type="hidden" name="purchaseOrderCode" th:value="${dto.purchaseOrderCode}">[[${dto.purchaseOrderCode}]]</td>
                            <td><input type="hidden" name="companyName" th:value="${dto.companyName}">[[${dto.companyName}]]</td>
                            <td><input type="hidden" name="dueDate" th:value="${dto.dueDate}">[[${#dates.format(dto.dueDate, 'yyyy/MM/dd')}]]</td>
                            <td><input type="hidden" name="materialName" th:value="${dto.materialName}">[[${dto.materialName}]]</td>
                            <td><input type="hidden" name="orderAmount" th:value="${dto.orderAmount}">[[${dto.orderAmount}]]</td>
                            <td><input type="hidden" name="unitPrice" th:value="${dto.unitPrice}">[[${dto.unitPrice}]]</td>
                            <td><input type="hidden" name="nextCheckDate" th:value="${dto.nextCheckDate}">[[${dto.nextCheckDate}]]</td>
                            <!-- 조달계획의 버튼 <button type="submit" id="data" class="btn btn-primary" style="float: right;" onclick="aaa()">데이터 보낼거야</button> -->
                            <td id="myadd">
                            <button name="checkBox" class="td-modal btn btn-primary addClass" id="addDateBtn" >일정 등록</button>
                            </td>
                            <td>
                            <button class="td-modal btn btn-primary avgClass" id="avgBtn" >평가</button>
                            </td>
                            <td>[[${dto.diliveryPercent}]]</td>
                            <td>[[${dto.inspectionComplete}]]</td>
                            <td>[[${dto.purchaseOrderDeadlineStatus}]]</td>
                        </tr>
                        
                      </tbody>
						</table>
						<!--페이지 번호 시작-->
                    <div class="clearfix">
                      <div class="hint-text">Showing <b>5</b> out of <b>25</b> entries</div>
                      <ul class="pagination">
                          <li class="page-item disabled"><a href="#"> << <i class="fa fa-angle-double-left"></i></a></li>
                          <li class="page-item"><a href="#" class="page-link">1</a></li>
                          <li class="page-item"><a href="#" class="page-link">2</a></li>
                          <li class="page-item active"><a href="#" class="page-link">3</a></li>
                          <li class="page-item"><a href="#" class="page-link">4</a></li>
                          <li class="page-item"><a href="#" class="page-link">5</a></li>
                          <li class="page-item"><a href="#" class="page-link">>><i class="fa fa-angle-double-right"></i></a></li>
                      </ul>
                  </div>
                  <!--페이지 번호 끝-->
					</div>
				</div>
			</div>
		</div>
<!-- 일정 등록을 눌렀을때 모달창 시작 -->
		<div class="addDate modal" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">진척검수 일정 등록</h5>
                    </div>
                    <div class="modal-body" >
						<body>
<h4><span id="companyName2">(여기에 회사 이름이 들어감)</span>의 진척검수 일정 등록입니다.&nbsp;<br>
진척검수일을 입력해 주세요</h4>
&nbsp;<br>
<div>
<input type="date" name="namemydate" id="idmydate">
</div>

&nbsp;<br>
<div class="sendDate22">
 <button id="pg22" class="btn btn-primary sendDate" style="padding-top:10px; padding-left:15px; padding-right:15px; width:60px; height:33px;">등록
  </button>
</div>
<!--  <div id="myplan"></div>
<script>
var arrInput = new Array(0);
  var arrInputValue = new Array(0);
 
function addInput() {
  arrInput.push(arrInput.length);
  arrInputValue.push("");
  display();
}
 
function display() {
  document.getElementById('myplan').innerHTML="";
  for (intI=0;intI<arrInput.length;intI++) {
    document.getElementById('myplan').innerHTML+=createInput(arrInput[intI], arrInputValue[intI]);
  }
}
 
function saveValue(intId,strValue) {
  arrInputValue[intId]=strValue;
}  
 
function createInput(id,value) {
  return "<input type='date' id='test "+ id +"' onChange='javascript:saveValue("+ id +",this.value)' value='"+ 
 
value +"'>"+"&nbsp;"+"<input type='button' id='test2' value='삭제' onclick='deleteInput(this);'>"+"<br>"+"<br>";
//value +"'><br>"; ->이게 원본
}
 
function deleteInput() {
  if (arrInput.length > 0) { 
     arrInput.pop(); 
     arrInputValue.pop();
  }
  display(); 
}
</script>
<form method="post" action="/procurement2/progressCheck">
<input type="button" value="추가" onclick="addInput();" />
<input type="submit" value="전송"/>
</form>
-->
</body>		
                    </div>
                    <div class="modal-footer">
                    
                      <button type="button" class="btn btn-secondary AllResetSetting" data-dismiss="modal" style="padding-top:10px; padding-left:15px; padding-right:15px; width:60px; height:33px;">
                        	닫기
                       </button>
                    </div>
                </div>
            </div>
        </div>

<!-- 체크박스 시작 -->


<!--진척 평가 시작-->
		<div class="addAvg modal" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                    <h5 class="modal-title">진척 평가</h5>
                    </div>
                    <div class="modal-body" >
					<span id="companyName3">(여기에 회사 이름이 들어감)</span>  제작 진척도를 입력합니다.
                   <br>
						<p class="card-title"><b>진척 평가</b></p>
						지난 검사 기록
						<br>
						
						<!--거래명세서 품목 정보-->
						<div class="table-responsive">
							<table id="transactionDetail"  border="1">
								<thead>
									<tr>
										<th>-</th>
										<th>날짜</th>
										<th>납기 진도율</th>
										<th>기타사항</th>
										
									</tr>
								</thead>
								<tbody>
									<tr>
										<td>-</td>
										<td><span id="lastDate">지난 검사일</span></td>
										<td>-</td>
										<td>-</td>
									</tr>
								</tbody>
							</table>
							<br>
							<br>
								<div>납기 진도율: <input name="mypercent" type="text" style="padding-top:10px; padding-left:15px; padding-right:15px; width:60px; height:28px;"></div>
								<br> <div>기타 사항: <input name="myetc" type="text" style="padding-top:10px; padding-left:15px; padding-right:15px; width:60px; height:28px;"></div>
						</div>
						<br>
						<br>
                    </div>
                    <div class="modal-footer">
                       <button  href="/procurement2/purchaseOrder?purchaseNo" class="btn btn-primary" style="padding-top:10px; padding-left:15px; padding-right:15px; width:60px; height:33px;">입력
                       </button>
                      <button type="button" class="btn btn-secondary AllResetSetting" data-dismiss="modal" style="padding-top:10px; padding-left:15px; padding-right:15px; width:60px; height:33px;">
                        	닫기
                       </button>
                    </div>
                    </div>
                </div>
            </div>
	<!--진척 평가 끝-->
<script src="https://code.jquery.com/jquery-3.7.0.js" integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM=" crossorigin="anonymous"></script>
<script th:inline="javascript" type="text/javascript">
//일정 등록 버튼을 누르면
var codeNo='';
$(".addClass").click(function(){
	$(".addDate").modal('show');
	console.log("일정 추가 버튼을 누름");
	//location.href="/procurement2/progressCheck?checkBox="+cList[0];
	//var searchCompanyTR = new Object();
	//console.log("tr 전역변수 만들고 난 값 : ",searchCompanyTR);
	//순서: 발주번호, 회사이름, 납기일, 물품이름, 주문수량, 단가, 다음 진척검수일
	//총 7개
	var pCode= getObjTR().querySelector("input[name=purchaseOrderCode]").value;
	var cName= getObjTR().querySelector("input[name=companyName]").value;
	var dDate= getObjTR().querySelector("input[name=dueDate]").value;
	var mName= getObjTR().querySelector("input[name=materialName]").value;
	var oAmount= getObjTR().querySelector("input[name=orderAmount]").value;
	var uPrice= getObjTR().querySelector("input[name=unitPrice]").value;
	var nDate= getObjTR().querySelector("input[name=nextCheckDate]").value;
	console.log("발주코드: ",pCode);//잘나옴
	console.log("회사이름: ",cName);
	console.log("납기일: ",dDate);
	console.log("물품이름: ",mName);
	console.log("주문수량: ",oAmount);
	console.log("단가: ",uPrice);
	console.log("다음 진척검수일: ",nDate);
	codeNo=getObjTR().querySelector("input[name=purchaseOrderCode]").value;//여기에서 값 넣어서 날짜등록으로 보내보기
	console.log("등록할때 필요한 발주번호: ",codeNo);//잘나옴
	document.querySelector("#companyName2").innerHTML = cName;
	
	//create element (form)
	//var inForm = $('<form></form>');
	
	//set attribute (form) 
	
	//inForm.attr("name","inForm");
	//inForm.attr("method","post");
	//inForm.attr("action","/procurement2/progressCheck");
	
	
});

$(".avgClass").click(function(){
	$(".addDate").modal('hide');
	console.log("평가 버튼을 누름");
	$(".addAvg").modal('show');
	//순서: 발주번호, 회사이름, 납기일, 물품이름, 주문수량, 단가, 다음 진척검수일
	//총 7개
	var pCode= getObjTR().querySelector("input[name=purchaseOrderCode]").value;
	var cName= getObjTR().querySelector("input[name=companyName]").value;
	var dDate= getObjTR().querySelector("input[name=dueDate]").value;
	var mName= getObjTR().querySelector("input[name=materialName]").value;
	var oAmount= getObjTR().querySelector("input[name=orderAmount]").value;
	var uPrice= getObjTR().querySelector("input[name=unitPrice]").value;
	var nDate= getObjTR().querySelector("input[name=nextCheckDate]").value;
	console.log("발주코드: ",pCode);//잘나옴
	console.log("회사이름: ",cName);
	console.log("납기일: ",dDate);
	console.log("물품이름: ",mName);
	console.log("주문수량: ",oAmount);
	console.log("단가: ",uPrice);
	console.log("다음 진척검수일: ",nDate);
	
	document.querySelector("#companyName3").innerHTML = cName;
	//날짜는 형태가 다르다 함document.querySelector("lastDate").innerHTML = nDate;
});

//진척검수 일정등록의 등록 버튼
$(".sendDate").click(function(){
	console.log("날짜 등록 버튼을 누름");
	//날짜를 찍어 보자 
	//날짜, 발주 코드
	var cDate=document.getElementById('idmydate').value;
	console.log("날짜 나와라: ", cDate); //잘 나온다
	
	let myList= new Array(); //여기에 두개 넣어서 보낼 생각
	//let no= $(this).val();
	myList.push(cDate);
	myList.push(codeNo);//여기에 발주 코드 넣어서 보내기
	console.log("리스트 : ", myList);
	$.ajax({
		type:"post",
		url:"/procurement2/progressCheck2",
		data: JSON.stringify(myList),
		contentType :"application/json; charset=UTF-8",
		dataType: "json",
		success: function(data){
			console.log("받아온 데이터 : ",data);
		}
	})
	
});

////////////////////////////////////////////////////////////////////////////////////
//이벤트 발생한 요소의 상위의 TD 객체 찾기
function getObj(){
    var obj = event.srcElement
    while (obj.tagName !='TD'){  //TD가 나올때까지의 Object추출
        obj = obj.parentElement
    }
    return obj
}

	//이벤트 발생한 요소의 상위의 TR 객체 찾기
function getObjTR(){
    var obj = event.srcElement
    while (obj.tagName !='TR'){  //TR가 나올때까지의 Object추출
        obj = obj.parentElement
    }
    return obj
}
</script>

	</th:block>

</th:block>
</html>